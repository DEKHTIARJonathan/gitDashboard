{% extends "layout.html" %}
{% load timeutils %}


{% block repoHeader %}
<b>Repository path:</b><a href="{% url gitview.views.commits %}?path={{ repoPath }}&branch={{branch}}">{{ repoPath }}</a>
{%endblock %}

{% block contentBlock %}
<script src="/static/js/kinetic-v3.8.2.min.js"></script>
<div id="canvasGraph" style="border:1px solid #000000;margin:auto;height:{{height}};width:100%;"></div>

<script type="text/javascript">
function line(x1,y1,x2,y2,color,layer){
	var ln = new Kinetic.Shape({
        drawFunc: function(){
            var context = this.getContext();
            context.beginPath();
        	context.lineWidth = 2;
        	context.strokeStyle = color;
        	oblique=false;
        	vertical=false;
        	if (x2-x1 != 0){
        		m = (y2 - y1) / (x2 - x1)
        		if (m!=0){
            		oblique=true
            	}
        	}else{
        		vertical=true
        	}
        	context.moveTo(x1,y1);
        	if (!oblique){
        		context.lineTo(x2,y2);
        		if (vertical){
        			if (y2<=y1){
        				//up
        				context.moveTo(x2,y2+7);
                		context.lineTo(x2-5,y2+10);
                		context.moveTo(x2,y2+7);
                		context.lineTo(x2+5,y2+10);
        			}else{
        				//down
        				context.moveTo(x2,y2-7);
                		context.lineTo(x2-10,y2-10);
                		context.moveTo(x2,y2-7);
                		context.lineTo(x2+10,y2-10);	
        			}
        		}else{
        			//horizzontal
        			context.moveTo(x2-7,y2);
            		context.lineTo(x2-10,y2-5);
            		context.moveTo(x2-7,y2);
            		context.lineTo(x2-10,y2+5);
        		}
        	}else{
        		//oblique
        		context.strokeStyle="#8ED6FF";
        		context.lineTo(x1,y2);
        		context.lineTo(x2,y2);
        		context.moveTo(x2-7,y2);
        		context.lineTo(x2-10,y2-5);
        		context.moveTo(x2-7,y2);
        		context.lineTo(x2-10,y2+5);
        	}
        	context.stroke();
        	context.closePath();
        	context.restore();
        }});
	layer.add(ln);
}
window.onload = function(){
	var width=document.getElementById("canvasGraph").offsetWidth;
	width=width-20;
	var stage = new Kinetic.Stage("canvasGraph", width, {{height}});
	var circlesLayer = new Kinetic.Layer();
	var tooltipLayer = new Kinetic.Layer();
	
	var lineGroup = new Kinetic.Group();
	var circleGroup = new Kinetic.Group();
	var textGroup = new Kinetic.Group();
	
	var backgroundRect=new Kinetic.Rect({
		x:0,
		y:0,
		width:{{width}},
		height:{{height}},
		fill:'#FFFFFF',
		alpha:0.0
		
	});
	backgroundRect.on("mousemove",function(){
		document.body.style.cursor = "move";
	})
	circleGroup.add(backgroundRect);

	{{canvasContent|safe}}
	
	circlesLayer.add(lineGroup);
	circlesLayer.add(circleGroup);
	circlesLayer.add(textGroup);
	
	circlesLayer.draggableX(true);
	

	//prevent to move after left border
	circlesLayer.on("dragend", function(e){
        if (circlesLayer.x>0){
        	circlesLayer.setPosition(0,0);
        	circlesLayer.draw();
        }
    });
	circlesLayer.move(-{{width}}+width-100,0);
	stage.add(circlesLayer);
	stage.add(tooltipLayer);
};
</script>


{% endblock %}
